# Replace these values locally (do NOT paste the key here)
$svc = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZpemRlenZsbmtmaW90Y3hreGFkIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MTQ3OTk3OSwiZXhwIjoyMDc3MDU1OTc5fQ.O0v-ICLwVVhrluwGGvzjnje86Y43qn8UbL4NT566oq0"
$userId = "4d2f38e1-5606-4164-801b-870629df2837"

$uri = "https://fizdezvlnkfiotcxkxad.supabase.co/auth/v1/admin/users/$userId/resend"
Write-Output "Calling: $uri"

try {
  $resp = Invoke-RestMethod -Uri $uri -Method Post -Headers @{
    apikey = $svc
    Authorization = "Bearer $svc"
    "Content-Type" = "application/json"
  } -Body "{}"

  Write-Output "SUCCESS"
  $resp | ConvertTo-Json -Depth 5
}
catch {
  Write-Output "ERROR DETAILS:"
  $ex = $_.Exception

  if ($ex.Response -ne $null) {
    $httpResp = $ex.Response
    # status code & description
    $statusCode = $httpResp.StatusCode.value__  # numeric
    $statusText = $httpResp.StatusDescription     # text
    Write-Output ("Status: {0} {1}" -f $statusCode, $statusText)

    # body
    $stream = $httpResp.GetResponseStream()
    $reader = New-Object System.IO.StreamReader($stream)
    $body = $reader.ReadToEnd()
    Write-Output ("Body: {0}" -f $body)
  } else {
    Write-Output ("Error: {0}" -f $ex.Message)
  }
}